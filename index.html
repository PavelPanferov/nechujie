<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Не чужие - Игра для пар</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --primary-gradient: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #6c5ce7 100%);
            --secondary-gradient: linear-gradient(135deg, #a8e6cf 0%, #3d9970 50%, #2c3e50 100%);
            --background: linear-gradient(135deg, #667eea 0%, #764ba2 40%, #e056fd 100%);
            --card-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --white: #ffffff;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            touch-action: manipulation;
            font-feature-settings: 'kern' 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            width: 100%;
            max-width: 420px;
            position: relative;
        }

        .start-screen, .game-screen, .name-input-screen, .comparison-screen {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 40px 30px;
            box-shadow: var(--card-shadow);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .start-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1em;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .heart-icon {
            font-size: 3em;
            margin: 20px 0;
            animation: heartbeat 2s ease-in-out infinite;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes heartbeat {
            0%, 50%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
        }

        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 30px 0;
        }

        button {
            -webkit-appearance: none;
            appearance: none;
            border: none;
            cursor: pointer;
            font-family: inherit;
            transition: var(--transition);
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        .level-btn {
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            padding: 24px 20px;
            border-radius: var(--radius-md);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            text-transform: none;
            letter-spacing: 0.02em;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .level-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .level-btn:hover::before {
            left: 100%;
        }

        .level-btn:active {
            transform: translateY(2px);
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.4);
        }

        .level-number {
            display: block;
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 6px;
            font-weight: 400;
            line-height: 1.3;
        }

        .progress-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        .progress-indicator.completed {
            background: #4CAF50;
            color: white;
        }

        .progress-indicator.in-progress {
            background: #FF9800;
            color: white;
        }

        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 40px 30px;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: var(--card-shadow);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-level {
            position: absolute;
            top: 16px;
            left: 20px;
            background: var(--primary-gradient);
            color: var(--white);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.2);
        }

        .card-number {
            position: absolute;
            top: 20px;
            right: 20px;
            color: var(--text-secondary);
            font-size: 0.9em;
            font-weight: 500;
        }

        .question {
            color: var(--text-primary);
            font-size: 1.3em;
            line-height: 1.5;
            font-weight: 500;
            margin: 20px 0;
            text-align: center;
            letter-spacing: -0.01em;
        }

        .task {
            background: var(--secondary-gradient);
            color: var(--white);
            padding: 30px 25px;
            border-radius: var(--radius-md);
            font-size: 1.2em;
            font-weight: 600;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(61, 153, 112, 0.3);
        }

        .task-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .navigation {
            display: flex;
            gap: 16px;
            margin-top: 30px;
            justify-content: center;
        }

        .nav-btn {
            background: var(--white);
            border: 2px solid transparent;
            background-clip: padding-box;
            color: var(--text-primary);
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            -webkit-tap-highlight-color: rgba(102, 126, 234, 0.1);
            outline: none;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 2px;
            background: var(--primary-gradient);
            border-radius: inherit;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            -webkit-mask-composite: xor;
        }

        .nav-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .next-btn {
            background: var(--primary-gradient);
            color: var(--white);
            border: none;
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
        }

        .next-btn::before {
            display: none;
        }

        .progress {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.3);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
        }

        .hidden {
            display: none !important;
        }

        .special-btn {
            background: var(--secondary-gradient);
            margin-top: 12px;
            box-shadow: 0 8px 25px rgba(61, 153, 112, 0.3);
        }

        .menu-btn {
            margin: 25px auto 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        /* Floating particles animation */
        .start-screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(255, 107, 157, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(108, 92, 231, 0.1) 0%, transparent 50%);
            pointer-events: none;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
                max-width: 100%;
            }

            .start-screen, .game-screen {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2.2em;
            }

            .question {
                font-size: 1.2em;
            }

            .card {
                padding: 30px 20px;
                min-height: 280px;
            }

            .level-btn {
                padding: 20px 16px;
                font-size: 0.95em;
            }

            .navigation {
                gap: 12px;
            }

            .nav-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }

        /* Стили для ввода имен */
        .name-inputs {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .input-group label {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .input-group input {
            padding: 16px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: var(--radius-md);
            font-size: 1em;
            font-family: inherit;
            background: var(--white);
            color: var(--text-primary);
            transition: var(--transition);
            outline: none;
        }

        .input-group input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        @media (hover: hover) {
            .level-btn:hover, .next-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 35px rgba(255, 107, 157, 0.4);
            }

            .nav-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            }

            .input-group input:hover {
                border-color: #667eea;
            }
        }

        /* Стили для режима сравнения */
        .comparison-choices {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 30px 0;
        }

        .choice-btn {
            background: var(--white);
            border: 3px solid rgba(102, 126, 234, 0.3);
            color: var(--text-primary);
            padding: 20px 24px;
            border-radius: var(--radius-md);
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .choice-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .choice-btn.selected {
            background: var(--primary-gradient);
            color: var(--white);
            border-color: transparent;
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
        }

        .choice-btn:active {
            transform: translateY(1px);
        }

        .player1-btn.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .player2-btn.selected {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="start-screen" id="startScreen">
            <div class="heart-icon">💕</div>
            <h1>Не чужие</h1>
            <p class="subtitle">Игра на сближение для пар</p>

            <div class="level-buttons">
                <button class="level-btn" onclick="startGame(1)" type="button" id="level1Btn">
                    Уровень 1: Восприятие
                    <span class="level-number">Узнайте первые впечатления</span>
                    <span class="progress-indicator" id="progress1"></span>
                </button>
                <button class="level-btn" onclick="startGame(2)" type="button" id="level2Btn">
                    Уровень 2: Связь
                    <span class="level-number">Создайте эмоциональную близость</span>
                    <span class="progress-indicator" id="progress2"></span>
                </button>
                <button class="level-btn" onclick="startGame(3)" type="button" id="level3Btn">
                    Уровень 3: Размышления
                    <span class="level-number">Откройте глубинные чувства</span>
                    <span class="progress-indicator" id="progress3"></span>
                </button>
                <button class="level-btn special-btn" onclick="startGame('tasks')" type="button" id="levelTasksBtn">
                    Специальные задания
                    <span class="level-number">Творческие активности для двоих</span>
                    <span class="progress-indicator" id="progressTasks"></span>
                </button>
                <button class="level-btn" onclick="startGame('comparison')" type="button" id="levelComparisonBtn" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    Ты или Я?
                    <span class="level-number">Угадайте склонности друг друга</span>
                    <span class="progress-indicator" id="progressComparison"></span>
                </button>
            </div>

            <button class="nav-btn" onclick="showNameInput()" type="button" style="margin-top: 20px;">
                ⚙️ Настройки
            </button>
        </div>

        <div class="name-input-screen hidden" id="nameInputScreen">
            <div class="heart-icon">👥</div>
            <h1>Знакомство</h1>
            <p class="subtitle">Как вас зовут?</p>

            <div class="name-inputs">
                <div class="input-group">
                    <label for="player1Name">Игрок 1:</label>
                    <input type="text" id="player1Name" placeholder="Введите имя" maxlength="15">
                </div>
                <div class="input-group">
                    <label for="player2Name">Игрок 2:</label>
                    <input type="text" id="player2Name" placeholder="Введите имя" maxlength="15">
                </div>
            </div>

            <div class="navigation">
                <button class="nav-btn" onclick="backToMenu()" type="button">
                    ← Назад
                </button>
                <button class="nav-btn next-btn" onclick="saveNames()" type="button">
                    Сохранить
                </button>
            </div>
        </div>

        <div class="game-screen hidden" id="gameScreen">
            <div class="card" id="card">
                <span class="card-level" id="levelLabel"></span>
                <span class="card-number" id="cardNumber"></span>
                <div id="cardContent"></div>
            </div>

            <div class="navigation">
                <button class="nav-btn" id="prevBtn" onclick="previousCard()" type="button">
                    ← Назад
                </button>
                <button class="nav-btn next-btn" onclick="nextCard()" type="button">
                    Далее →
                </button>
            </div>

            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <button class="nav-btn menu-btn" onclick="backToMenu()" type="button">
                В меню
            </button>
        </div>

        <div class="comparison-screen hidden" id="comparisonScreen">
            <div class="card" id="comparisonCard">
                <span class="card-level" id="comparisonLevelLabel">Ты или Я?</span>
                <span class="card-number" id="comparisonCardNumber"></span>
                <div class="question" id="comparisonQuestion"></div>

                <div class="comparison-choices">
                    <button class="choice-btn player1-btn" id="player1Choice" onclick="makeChoice(1)" type="button">
                        <span id="player1ChoiceText">Игрок 1</span>
                    </button>
                    <button class="choice-btn player2-btn" id="player2Choice" onclick="makeChoice(2)" type="button">
                        <span id="player2ChoiceText">Игрок 2</span>
                    </button>
                </div>
            </div>

            <div class="navigation">
                <button class="nav-btn" id="comparisonPrevBtn" onclick="previousComparisonCard()" type="button">
                    ← Назад
                </button>
                <button class="nav-btn next-btn" id="comparisonNextBtn" onclick="nextComparisonCard()" type="button" disabled>
                    Далее →
                </button>
            </div>

            <div class="progress">
                <div class="progress-bar" id="comparisonProgressBar"></div>
            </div>

            <button class="nav-btn menu-btn" onclick="backToMenu()" type="button">
                В меню
            </button>
        </div>
    </div>

    <script>
        const questions = {
            1: [
                // Оригинальные вопросы
                "Как ты думаешь, какая у меня была специальность в университете?",
                "Как ты думаешь, я когда-нибудь был(а) безответно влюблен(а)?",
                "Как ты думаешь, мне когда-нибудь разбивали сердце?",
                "Как ты думаешь, я был(а) популярен(на) в школе?",
                "Как ты думаешь, мне больше нравится быть дома или гулять?",
                "Как ты думаешь, я экстраверт или интроверт?",
                "Какое, по-твоему, мое любимое блюдо?",
                "Какой, по-твоему, мой любимый напиток?",
                "Как ты думаешь, я люблю читать книги?",
                "Как ты думаешь, я играю в видеоигры?",
                "Какой, по-твоему, мой любимый цвет?",
                "Как ты думаешь, я жаворонок или сова?",
                "Какую музыку я слушаю чаще всего?",
                "Как ты думаешь, я люблю путешествовать?",
                "Какое мое любимое время года?",

                // Новые вопросы на основе методики Артура Арона
                "Если бы у тебя была возможность поужинать с любым человеком в мире, кого бы ты выбрал(а)?",
                "Хотел(а) бы ты стать знаменитым(ой)? Каким образом?",
                "Перед тем как позвонить, ты репетируешь то, что собираешься сказать?",
                "Что для тебя означает «идеальный день»?",
                "Когда ты в последний раз пел(а) для себя? А для кого-то другого?",
                "Если бы ты мог(ла) дожить до 90 лет и сохранить либо разум, либо тело 30-летнего до последнего дня, что бы ты выбрал(а)?",
                "Есть ли у тебя тайное предчувствие о том, как ты умрешь?",
                "Назови три вещи, которые у нас с тобой общие.",
                "За что в своей жизни ты испытываешь наибольшую благодарность?",
                "Если бы ты мог(ла) изменить что-то в том, как тебя воспитывали, что бы это было?",
                "Расскажи историю своей жизни за четыре минуты, включив как можно больше подробностей.",
                "Если бы завтра ты проснулся(лась) с каким-то новым качеством или способностью, какой бы она была?",
                "Есть ли что-то, о чем ты мечтаешь уже долгое время? Почему ты этого еще не сделал(а)?",
                "Какое твое самое ценное воспоминание?",
                "Какое твое самое ужасное воспоминание?",
                "Какую роль играют любовь и привязанность в твоей жизни?",
                "По очереди поделитесь тем, что считаете положительными качествами партнера. Поделитесь пятью пунктами.",
                "Насколько близка и дружна твоя семья? Чувствуешь ли ты, что детство у тебя было более счастливым, чем у большинства людей?",
                "Как ты относишься к отношениям со своей матерью?"
            ],
            2: [
                // Оригинальные вопросы
                "Каким было твое первое впечатление обо мне?",
                "О чем ты солгал(а) мне в последний раз?",
                "Что ты скрывал(а) от меня долгое время?",
                "Какие самые странные мысли приходят тебе в голову?",
                "Какую самую большую ошибку ты совершил(а) в жизни?",
                "Что ты все еще пытаешься доказать себе?",
                "Что самое сложное в отношениях со мной?",
                "Какое твое самое теплое воспоминание из детства?",
                "Что нужно сделать, чтобы завоевать твое доверие?",
                "Какой главный вопрос волнует тебя сейчас?",
                "Что сделало бы тебя еще ближе ко мне?",
                "Чего ты боишься в наших отношениях?",
                "Какой момент стал переломным для нас?",
                "Что бы ты изменил(а) в нашем общении?",
                "Какая моя привычка тебя раздражает?",

                // Новые вопросы на основе методик Готтмана (Карты любви)
                "Какие у тебя сейчас главные цели и стремления?",
                "Что тебя больше всего интересует из того, чем ты не занимался(лась) в прошлом году?",
                "Какой самый большой стресс в твоей жизни прямо сейчас?",
                "Кто твои самые близкие друзья? Расскажи о них.",
                "Какие события из детства сформировали тебя как личность?",
                "Какая твоя самая заветная мечта на будущее?",
                "Что заставляет тебя чувствовать себя по-настоящему живым(ой)?",
                "Как ты справляешься с трудными временами?",

                // Вопросы на привязанность и восхищение (Готтман)
                "Расскажи о моменте, когда ты чувствовал(а) себя особенно любимым(ой) мной.",
                "Какое качество во мне тебе нравится больше всего?",
                "Когда ты в последний раз гордился(лась) мной?",
                "Какой совместный момент был для тебя самым счастливым?",
                "За что ты благодарен(на) мне больше всего?",
                "Что я делаю, что заставляет тебя чувствовать себя особенным(ой)?",

                // Более глубокие вопросы из методики Арона (уровень 2)
                "Перед кем ты позвонил бы, если бы узнал, что умрешь через час?",
                "Поделись личной проблемой и попроси у партнера совета.",
                "Если бы ты подружился со мной, что было бы важно, чтобы я знал(а)?",
                "Скажи партнеру, что тебе в нем нравится; будь очень честным(ой).",
                "Поделись неловким моментом из своей жизни.",
                "Когда ты в последний раз плакал(а) перед другим человеком? А один?",
                "Что для тебя слишком серьезно, чтобы шутить об этом?"
            ],
            3: [
                "Что ты хочешь изменить в себе прямо сейчас?",
                "Перед кем ты хочешь извиниться?",
                "Что во мне тебя больше всего удивило?",
                "Какая у меня суперсила в отношениях?",
                "Что мне стоит прочитать или посмотреть?",
                "Что ты узнал(а) о себе благодаря нашим отношениям?",
                "Какой вопрос был самым сложным для тебя?",
                "Что было бы идеальным подарком для меня?",
                "Что мне нужно услышать прямо сейчас?",
                "Почему мы встретились именно сейчас?",
                "Что мы можем создать вместе?",
                "Что во мне самое привлекательное помимо внешности?",
                "Как выглядит наша жизнь через 10 лет?",
                "Есть ли что-то непростительное для тебя?",
                "Чему научили тебя наши отношения?"
            ],
            tasks: [
                // Оригинальные задания
                {type: "task", content: "Нарисуйте портреты друг друга", time: "2 минуты", icon: "🎨"},
                {type: "task", content: "Создайте историю по очереди", time: "3 минуты", icon: "📖"},
                {type: "task", content: "Напишите любовные записки", time: "5 минут", icon: "✉️"},
                {type: "task", content: "Сделайте романтичное фото", icon: "📸"},
                {type: "task", content: "Смотрите в глаза молча", time: "1 минута", icon: "👁️"},
                {type: "task", content: "Спойте любимые песни", icon: "🎤"},
                {type: "task", content: "Обнимитесь крепко-крепко", time: "30 секунд", icon: "🤗"},
                {type: "task", content: "Потанцуйте вместе", time: "1 песня", icon: "💃"},
                {type: "task", content: "Покажите детские фото", icon: "👶"},
                {type: "task", content: "Сделайте массаж плеч", time: "2 минуты каждому", icon: "💆"},

                // Новые физические и сенсорные задания
                {type: "task", content: "Игра 'Таинственное прикосновение': один с завязанными глазами угадывает предметы", time: "3 минуты", icon: "🙈"},
                {type: "task", content: "Парная йога: примите позу 'двойного дерева' вместе", time: "1 минута", icon: "🧘‍♀️"},
                {type: "task", content: "Игра 'Зеркало': один показывает движения, другой повторяет", time: "2 минуты", icon: "🪞"},
                {type: "task", content: "Покормите друг друга с закрытыми глазами", time: "3 минуты", icon: "🍓"},

                // Творческие и совместные проекты
                {type: "task", content: "Создайте 'банку воспоминаний': запишите 5 лучших совместных моментов", time: "10 минут", icon: "🏺"},
                {type: "task", content: "Нарисуйте вместе одну картину четырьмя руками", time: "5 минут", icon: "🎨"},
                {type: "task", content: "Сочините и спойте песню о вашей любви", time: "5 минут", icon: "🎵"},
                {type: "task", content: "Создайте секретный язык жестов только для вас двоих", time: "5 минут", icon: "🤝"},

                // Задания на доверие и близость
                {type: "task", content: "Упражнение 'Падение': один падает назад, другой ловит", time: "2 минуты", icon: "🤸‍♀️"},
                {type: "task", content: "Дышите синхронно 10 вдохов-выдохов", time: "2 минуты", icon: "💨"},
                {type: "task", content: "Обменяйтесь одним секретом, которым никогда не делились", icon: "🤐"},
                {type: "task", content: "Сделайте друг другу комплимент на разных языках", icon: "🗣️"},

                // Игровые и веселые задания
                {type: "task", content: "Изобразите друг друга без слов, пусть угадает", time: "3 минуты", icon: "🎭"},
                {type: "task", content: "Станцуйте танец только руками сидя", time: "1 песня", icon: "👐"},
                {type: "task", content: "Опишите цвет, не называя его - пусть партнер угадает", time: "2 минуты", icon: "🌈"},
                {type: "task", content: "Нарисуйте совместный автопортрет не глядя на бумагу", time: "3 минуты", icon: "👫"},

                // Задания на будущее
                {type: "task", content: "Спланируйте идеальные выходные вместе", time: "5 минут", icon: "📅"},
                {type: "task", content: "Создайте список из 10 мест, которые хотите посетить вместе", time: "5 минут", icon: "🗺️"},
                {type: "task", content: "Напишите письмо себе в будущее на годовщину", time: "10 минут", icon: "💌"},

                // Задания на неделю/месяц
                {type: "task", content: "Недельный вызов: каждый день говорите по одному новому комплименту", time: "7 дней", icon: "📆"},
                {type: "task", content: "Договоритесь попробовать новое хобби вместе в этом месяце", icon: "🆕"},
                {type: "task", content: "Создайте традицию: что будете делать каждые выходные", icon: "🔄"}
            ],
            comparison: [
                "Кто из нас чаще опаздывает на встречи?",
                "Кто из нас более организованный?",
                "Кто из нас готовит лучше?",
                "Кто из нас более романтичный?",
                "Кто из нас чаще инициирует объятия?",
                "Кто из нас более спонтанный?",
                "Кто из нас лучше запоминает важные даты?",
                "Кто из нас более терпеливый?",
                "Кто из нас чаще говорит 'извини'?",
                "Кто из нас более смелый?",
                "Кто из нас лучше танцует?",
                "Кто из нас быстрее засыпает?",
                "Кто из нас чаще смеется?",
                "Кто из нас более щедрый?",
                "Кто из нас лучше водит машину?",
                "Кто из нас более эмоциональный?",
                "Кто из нас чаще забывает, где положил ключи?",
                "Кто из нас лучше разбирается в технике?",
                "Кто из нас более оптимистичный?",
                "Кто из нас чаще принимает решения в отношениях?",
                "Кто из нас лучше умеет экономить деньги?",
                "Кто из нас более чувствительный к критике?",
                "Кто из нас чаще мечтает?",
                "Кто из нас более активный в социальных сетях?",
                "Кто из нас лучше поддерживает в трудную минуту?",
                "Кто из нас чаще предлагает новые идеи для свиданий?",
                "Кто из нас более пунктуальный?",
                "Кто из нас лучше умеет хранить секреты?",
                "Кто из нас чаще говорит комплименты?",
                "Кто из нас более креативный?"
            ]
        };

        let currentLevel = 1;
        let currentCardIndex = 0;
        let currentQuestions = [];
        let player1Name = "";
        let player2Name = "";
        let selectedChoice = null;
        let comparisonAnswers = [];

        function startGame(level) {
            currentLevel = level;
            selectedChoice = null;

            if (level === 'comparison') {
                startComparisonMode();
                return;
            }

            currentQuestions = [...questions[level]];

            // Загружаем сохраненный прогресс или начинаем заново
            const savedProgress = localStorage.getItem(`progress_${level}`);
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                currentCardIndex = progress.cardIndex || 0;
                // Используем сохраненный порядок вопросов
                if (progress.questions && progress.questions.length === currentQuestions.length) {
                    currentQuestions = progress.questions;
                } else {
                    // Если структура изменилась, перемешиваем заново
                    shuffleQuestions();
                }
            } else {
                currentCardIndex = 0;
                shuffleQuestions();
            }

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('nameInputScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('comparisonScreen').classList.add('hidden');

            const levelNames = {
                1: "Уровень 1",
                2: "Уровень 2",
                3: "Уровень 3",
                'tasks': "Задания"
            };

            document.getElementById('levelLabel').textContent = levelNames[level];

            showCard();
        }

        function startComparisonMode() {
            currentQuestions = [...questions.comparison];
            comparisonAnswers = [];

            // Загружаем сохраненный прогресс
            const savedProgress = localStorage.getItem(`progress_comparison`);
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                currentCardIndex = progress.cardIndex || 0;
                comparisonAnswers = progress.answers || [];
                if (progress.questions && progress.questions.length === currentQuestions.length) {
                    currentQuestions = progress.questions;
                } else {
                    shuffleQuestions();
                }
            } else {
                currentCardIndex = 0;
                shuffleQuestions();
            }

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('nameInputScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('comparisonScreen').classList.remove('hidden');

            // Обновляем имена игроков
            document.getElementById('player1ChoiceText').textContent = player1Name || 'Игрок 1';
            document.getElementById('player2ChoiceText').textContent = player2Name || 'Игрок 2';

            showComparisonCard();
        }

        function shuffleQuestions() {
            // Перемешиваем вопросы
            for (let i = currentQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [currentQuestions[i], currentQuestions[j]] = [currentQuestions[j], currentQuestions[i]];
            }
            saveProgress();
        }

        function saveProgress() {
            const progress = {
                cardIndex: currentCardIndex,
                questions: currentQuestions,
                timestamp: Date.now()
            };
            localStorage.setItem(`progress_${currentLevel}`, JSON.stringify(progress));
        }

        function showCard() {
            const content = document.getElementById('cardContent');
            const current = currentQuestions[currentCardIndex];
            
            if (currentLevel === 'tasks') {
                const task = current;
                content.innerHTML = `
                    <div class="task">
                        <div class="task-icon">${task.icon}</div>
                        <div>${task.content}</div>
                        ${task.time ? `<div style="margin-top: 10px; font-size: 0.85em; opacity: 0.9;">⏱️ ${task.time}</div>` : ''}
                    </div>
                `;
            } else {
                content.innerHTML = `<div class="question">${current}</div>`;
            }
            
            document.getElementById('cardNumber').textContent = `${currentCardIndex + 1}/${currentQuestions.length}`;
            
            const progress = ((currentCardIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            document.getElementById('prevBtn').disabled = currentCardIndex === 0;
        }

        function nextCard() {
            if (currentCardIndex < currentQuestions.length - 1) {
                currentCardIndex++;
                saveProgress();
                showCard();
            } else {
                // Все карточки пройдены
                const levelNames = {
                    1: "первый уровень",
                    2: "второй уровень",
                    3: "третий уровень",
                    'tasks': "специальные задания"
                };

                if (confirm(`Поздравляем! Вы прошли ${levelNames[currentLevel]}! 🎉\n\nВернуться в меню?`)) {
                    // Сбрасываем прогресс этого уровня
                    localStorage.removeItem(`progress_${currentLevel}`);
                    backToMenu();
                }
            }
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                saveProgress();
                showCard();
            }
        }

        function showComparisonCard() {
            const question = currentQuestions[currentCardIndex];
            document.getElementById('comparisonQuestion').textContent = question;
            document.getElementById('comparisonCardNumber').textContent = `${currentCardIndex + 1}/${currentQuestions.length}`;

            const progress = ((currentCardIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('comparisonProgressBar').style.width = progress + '%';

            // Сбрасываем выбор
            selectedChoice = null;
            document.getElementById('player1Choice').classList.remove('selected');
            document.getElementById('player2Choice').classList.remove('selected');
            document.getElementById('comparisonNextBtn').disabled = true;

            // Восстанавливаем предыдущий выбор если есть
            if (comparisonAnswers[currentCardIndex]) {
                selectedChoice = comparisonAnswers[currentCardIndex];
                const choiceBtn = selectedChoice === 1 ? 'player1Choice' : 'player2Choice';
                document.getElementById(choiceBtn).classList.add('selected');
                document.getElementById('comparisonNextBtn').disabled = false;
            }

            document.getElementById('comparisonPrevBtn').disabled = currentCardIndex === 0;
        }

        function makeChoice(choice) {
            selectedChoice = choice;
            comparisonAnswers[currentCardIndex] = choice;

            // Обновляем визуальное состояние кнопок
            document.getElementById('player1Choice').classList.remove('selected');
            document.getElementById('player2Choice').classList.remove('selected');

            const choiceBtn = choice === 1 ? 'player1Choice' : 'player2Choice';
            document.getElementById(choiceBtn).classList.add('selected');

            document.getElementById('comparisonNextBtn').disabled = false;

            // Сохраняем прогресс
            saveComparisonProgress();
        }

        function saveComparisonProgress() {
            const progress = {
                cardIndex: currentCardIndex,
                questions: currentQuestions,
                answers: comparisonAnswers,
                timestamp: Date.now()
            };
            localStorage.setItem(`progress_comparison`, JSON.stringify(progress));
        }

        function nextComparisonCard() {
            if (currentCardIndex < currentQuestions.length - 1) {
                currentCardIndex++;
                saveComparisonProgress();
                showComparisonCard();
            } else {
                // Показываем результаты
                const player1Count = comparisonAnswers.filter(answer => answer === 1).length;
                const player2Count = comparisonAnswers.filter(answer => answer === 2).length;

                const player1NameDisplay = player1Name || 'Игрок 1';
                const player2NameDisplay = player2Name || 'Игрок 2';

                const result = `Результаты игры "Ты или Я?":\n\n${player1NameDisplay}: ${player1Count} раз\n${player2NameDisplay}: ${player2Count} раз\n\nСпасибо за игру! 💕`;

                if (confirm(result + '\n\nВернуться в меню?')) {
                    localStorage.removeItem(`progress_comparison`);
                    backToMenu();
                }
            }
        }

        function previousComparisonCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                saveComparisonProgress();
                showComparisonCard();
            }
        }

        function backToMenu() {
            document.getElementById('startScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('nameInputScreen').classList.add('hidden');
            document.getElementById('comparisonScreen').classList.add('hidden');

            // Обновляем индикаторы прогресса
            updateProgressIndicators();
        }

        function showNameInput() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('nameInputScreen').classList.remove('hidden');

            // Загружаем сохраненные имена
            const savedName1 = localStorage.getItem('player1Name');
            const savedName2 = localStorage.getItem('player2Name');

            if (savedName1) {
                document.getElementById('player1Name').value = savedName1;
                player1Name = savedName1;
            }
            if (savedName2) {
                document.getElementById('player2Name').value = savedName2;
                player2Name = savedName2;
            }
        }

        function saveNames() {
            const name1 = document.getElementById('player1Name').value.trim();
            const name2 = document.getElementById('player2Name').value.trim();

            if (name1) {
                player1Name = name1;
                localStorage.setItem('player1Name', name1);
            }
            if (name2) {
                player2Name = name2;
                localStorage.setItem('player2Name', name2);
            }

            backToMenu();

            // Показать уведомление
            if (name1 || name2) {
                const message = name1 && name2 ?
                    `Привет, ${name1} и ${name2}! 💕` :
                    `Привет, ${name1 || name2}! 💕`;

                // Временно показать сообщение
                const subtitle = document.querySelector('.start-screen .subtitle');
                const originalText = subtitle.textContent;
                subtitle.textContent = message;
                subtitle.style.color = '#667eea';
                subtitle.style.fontWeight = '600';

                setTimeout(() => {
                    subtitle.textContent = originalText;
                    subtitle.style.color = '';
                    subtitle.style.fontWeight = '';
                }, 3000);
            }
        }

        function updateProgressIndicators() {
            const levels = [1, 2, 3, 'tasks', 'comparison'];

            levels.forEach(level => {
                const progress = localStorage.getItem(`progress_${level}`);
                let indicatorId;

                if (level === 'tasks') {
                    indicatorId = 'progressTasks';
                } else if (level === 'comparison') {
                    indicatorId = 'progressComparison';
                } else {
                    indicatorId = `progress${level}`;
                }

                const indicator = document.getElementById(indicatorId);

                if (progress) {
                    const data = JSON.parse(progress);
                    const totalQuestions = questions[level].length;
                    const currentCard = data.cardIndex || 0;
                    const progressPercent = Math.round((currentCard / totalQuestions) * 100);

                    if (currentCard >= totalQuestions - 1) {
                        indicator.textContent = '✓';
                        indicator.className = 'progress-indicator completed';
                    } else {
                        indicator.textContent = `${progressPercent}%`;
                        indicator.className = 'progress-indicator in-progress';
                    }
                } else {
                    indicator.textContent = '';
                    indicator.className = 'progress-indicator';
                }
            });
        }

        // Загружаем имена при загрузке страницы
        window.addEventListener('load', function() {
            const savedName1 = localStorage.getItem('player1Name');
            const savedName2 = localStorage.getItem('player2Name');

            if (savedName1) player1Name = savedName1;
            if (savedName2) player2Name = savedName2;

            // Обновляем индикаторы прогресса
            updateProgressIndicators();
        });

        // Предотвращаем двойной клик и масштабирование
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        document.addEventListener('dblclick', function(e) {
            e.preventDefault();
        });

        // Улучшаем работу с touch событиями
        document.addEventListener('touchstart', function() {}, { passive: true });

        // Добавляем обработчики для лучшей работы кнопок на мобильных
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
            }, { passive: true });

            button.addEventListener('touchend', function() {
                this.style.transform = '';
            }, { passive: true });
        });
    </script>
</body>
</html>
